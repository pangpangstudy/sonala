# solana 前世今生

17 年诞生 18 年谋划 19 年积累 20 年试发行 21 年暴涨

## 什么是 Solana？

1. 宗旨：为大规模应用，提供一条符合摩尔定律扩容的，高性能且费用低的公链.
   也就是说 Solana 目标是，性能高、TPS 高、费用低。随着硬件设施的提高，这种优势越来越明显。但是节点相对较少
2. 虫洞协议：他是 Solana 在 2019 年实现的一个以太坊桥。实现了 solana 与以太坊间的资产转移，是的以太坊上的合约快速低成本的迁移到 SOlana 公链，这也为 Solana 自己抢在以太坊 Layer2 扩容方案落地之前，赢得了大量的优质的项目和活跃的客户。
   没有客户--->发明虫洞协议---->跨链迁移到 Solana 中---->赢得大量用户

## 什么是 SOL

1. 它是 solana 公链本身经济激励的原生代币
2. 它的激励是基于有委托的 Pos 共识算法 DPos，这种算法我们可以把他理解为让给常务委员会来行使裁决权。
3. SOL 主要会在 3 中场景下被激励： 质押、交易、治理
4. SOL 的发型采用了类似 BTC 的机制，前期通胀率高，后期通胀率低，初始的供应量：488587349 枚，最后总供应量会趋于稳定。 支付的产生的部分手续费会被销毁，以维持币价稳定。

### POS

权益证明（Proof of Stake，简称 PoS）是一种区块链共识机制，旨在通过选择代币持有者来验证和确认网络中的交易，从而形成新的区块。PoS 与工作量证明（PoW）不同，它不依赖于计算能力和能量消耗来维护网络的安全，而是依赖于代币持有者的持币数量及其质押的代币来选择区块验证者。

#### PoS 的工作原理

1. 质押
   在 PoS 系统中，代币持有者可以将他们的代币锁定或“质押”在网络中。质押的代币数量越多，该持有者被选为验证者的概率越大。
   这些质押的代币作为一种“保证金”，如果验证者行为不当，如故意创建无效区块或进行双重支付攻击，他们的质押可能会被部分或全部没收。这一机制确保了验证者有动机维护网络的诚实性和安全性。
2. 选择验证者
   PoS 系统定期从质押者中随机选择一个或多个验证者来创建新的区块。选择过程通常是伪随机的，依据质押的代币数量和其他因素（如账户年龄、随机数等）来决定。
   被选中的验证者负责打包并验证交易，生成新区块并将其添加到区块链上。
3. 验证和共识：
   其他验证者会检查新区块的有效性，如果多数验证者同意新区块的合法性，它将被添加到区块链中。
   如果验证者企图作弊，他们可能会失去部分或全部质押的代币。
4. 奖励：
   成功生成和验证区块的验证者会收到新发行的代币和/或交易费用作为奖励。这些奖励激励验证者参与并维护网络。

### SOL 的共识机制：有委托的 PoS（DPos）

Solana 使用的是一种被称为 有委托的权益证明（Delegated Proof of Stake, DPoS） 的共识算法。这种算法的运作方式与普通的权益证明（PoS）有一些区别：

普通的 PoS：在普通的 PoS 系统中，节点（通常称为验证者或矿工）根据他们持有的代币数量的多少来被选择验证和添加新区块。持有的代币越多，被选择的概率越大。所有持有代币的用户可以直接参与共识过程。

DPoS：在 DPoS 系统中，代币持有者（通常称为“委托人”）不直接参与区块验证的过程，而是投票选出一组受信任的验证者来代表他们进行区块的验证和生产。这组被选出的验证者有点类似于常务委员会，他们负责网络的运作和维护，行使裁决权。这种机制通常会增加网络的效率和交易处理速度，因为只有一小部分节点在进行区块生产，而不是整个网络。

这种系统中的“委托”机制使得持有者可以将其持有的 SOL 代币“委托”给他们信任的验证者，后者将代币数量作为权重来增加他们被选为验证者的概率。验证者们通过验证交易和生产区块获得奖励，而这些奖励也会分配给委托给他们的持有者。

## solana 的新颖性和创造性

1. 链中的区块，不是有多个节点竞争获得，而是基于 DPos 机制选举出的 Leader 节点去生成的（带有中心化的色彩），并针对区块里的交易等内容，生成 PoH 证明（历史证明 Proof of History），并依据这些证明将一个个区块链接成链。

   节点--->Dpos--->Leader 节点

   DPOS-->Leader 节点--->生成新节点--->生成 PoH 证明--->依据证明链接成链

   数学原理依然还是 HASH-->HASH-->HASH
   ![](https://syshems.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F15e1b553-cd90-4911-afdb-43e2b044cf64%2F516b777d-9f73-4eb2-ab4f-7f123b906705%2FUntitled.png?table=block&id=3678625a-59c9-4ba1-b69c-96ceac31b5b5&spaceId=15e1b553-cd90-4911-afdb-43e2b044cf64&width=1980&userId=&cache=v2)

2. 高吞吐(TPS),因为 miner 不在需要去计算高难度的 nonce 来获得区块，所以更快了。
3. 低费用，因为只是 Leader 节点进行打包，而不是众多节点参与交易封装区块，所以没有消耗太多的计算资源，所以更便宜了
4. 高扩展性
5. 作为普通节点，可以作为 Validator 或者 Verifier 来参与交易的有效性验证，leader 节点合规性检查等活动，从而维护 Solana 区块链去中心化

### Validator（验证者）

验证者是 Solana 网络中关键的角色之一，负责验证和确认交易，并添加新区块到区块链上。验证者的主要职责包括：
交易验证: 验证者接收并验证交易的有效性。这包括检查交易的签名、账户余额、以及其他交易条件是否符合网络协议的要求。
共识参与: 验证者通过参与 Solana 的共识机制（如 Tower BFT），帮助网络就新区块达成共识。验证者会根据交易的 PoH（历史证明）时间戳和自身的质押情况，参与投票确定新区块。
区块生产: 虽然不是每个验证者都会直接生产区块（这个角色由 Leader 节点负责），但验证者会验证 Leader 节点生产的区块是否有效，并在共识机制下达成共识。
质押和奖励: 验证者需要质押一定数量的 SOL 代币作为保证金。如果验证者表现良好，他们可以通过网络分配的奖励获得回报。质押和奖励的机制有助于激励验证者的积极参与和诚实行为

### Verifier（验证者）

在 Solana 中，“Verifier”一词通常用来泛指所有参与交易和区块验证过程的节点，包括 Validator。不过，有时 Verifier 也特指在网络中专门负责验证特定数据或活动的节点，例如在数据存储方面的验证。
数据验证: 验证链上交易和区块的数据有效性，确保所有记录的正确性。

执行检查: 检查 Leader 节点的行为是否符合网络规则，如确认 Leader 在生产区块时没有作恶或作弊。

### Leader 节点和 Validator 的关系

Leader 节点在 Solana 网络中负责打包交易并生成新区块。Leader 节点的选举是由网络中的验证者（Validator）通过质押和共识机制共同决定的。Leader 节点会在一定时间内担任区块生产者，然后轮换到下一个 Leader 节点。
Leader 节点的工作主要包括：

- 交易排序: Leader 节点接收交易，并按照 PoH 生成的时间戳排序。
- 区块生成: 将排序后的交易打包成区块，并提交给验证者网络进行验证。

通过 Validator 和 Verifier 的广泛参与，Solana 确保了网络的去中心化和安全性。每个 Validator 节点都有机会被选为 Leader 节点，同时所有节点共同参与共识过程。这种设计避免了单一节点对网络的控制，分散了权力和责任，提升了网络的抗审查性和容错性。

# Solana 白皮书通读

## 介绍

1. 区块链使用复制状态机的方式解决容错问题。
2. Solana 之前区块链不依赖事件，或者对参与者保持时间的能力做出弱假设；缺乏可信的事件来源意味着当使用消息时间戳来接受或者拒绝消息是，从而无法保证网络中的每个其他参与者都会做出完全相同的选择，进而无法保持区块链网络的状态在诸区块链节点之间保持一致。
3. Solana 通过 POH 实现了一种基于可验证时间流逝的账本，来维护区块链网络上的状态；也就是区块的时间流逝由 POH 算法保障，是不需要信任的；同时 POH 机制减少了 PBFT 算法在链网络节点间消息的传递，从而可以实现对用户的亚秒级响应。
4. 而关于账本被恶意几点的伪造，则由 POH 结合 PoRep 来防御
5. 而负责执行 Poh 和 PoRep 的节点，则是由 DPOS 协议选举和公式，从而确保这些节点的公正性。

### 复制状态机和容错问题

在区块链中，“复制状态机”是一种技术手段，它将区块链看作是一个不断更新状态的机器。每个区块链节点都运行相同的程序，接受相同的输入（例如交易），然后产生相同的输出（更新后的区块链状态）。通过这种方式，即使有一些节点出现故障或行为不端，区块链系统依然能够保持一致和正常运行。

### 时间同步和事件依赖问题

在 Solana 之前的区块链中，由于节点之间没有统一的时间标准，因此无法可靠地依赖事件发生的时间来判断事件的有效性。换句话说，如果节点 A 和节点 B 在不同的时间收到同一条消息，可能会对这条消息的有效性做出不同的判断，从而导致节点之间的状态不一致。

### Solana 的 POH 机制

Solana 引入了一种叫做“历史证明”（Proof of History，POH）的机制来解决这个问题。POH 可以理解为一种可靠的时间记录方法，它为每个事件提供一个可信的时间顺序。这样，所有节点都可以看到同样的事件顺序，从而在处理这些事件时做出一致的决定。由于 POH 是基于加密算法的，因此不需要信任任何特定的节点，这确保了时间顺序的可靠性。

### 防止账本伪造

为了防止一些恶意节点伪造区块链的账本，Solana 结合了 POH 和另一种机制，叫做 PoRep（Proof of Replication）。PoRep 是一种证明数据已经被安全存储和复制的方法，这样即使有人试图伪造数据，其他节点也能检测出来并防止这种行为。

### 选举公正节点

Solana 使用一种称为“有委托的权益证明”（DPoS）的机制来选举负责执行 POH 和 PoRep 的节点。DPoS 类似于选举委员会的方式，代币持有者投票选出一组他们信任的节点来负责区块链的管理工作。这些节点需要公平和诚实地执行任务，因为不诚实行为会导致他们失去信任和奖励。

## 网络设计

!()[https://syshems.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F15e1b553-cd90-4911-afdb-43e2b044cf64%2F9c82b5da-182d-43fe-9536-a0beca21bdd9%2FUntitled.png?table=block&id=6e638718-b0f4-4798-a6fa-d81d33fe74ea&spaceId=15e1b553-cd90-4911-afdb-43e2b044cf64&width=1420&userId=&cache=v2]

!()[https://syshems.notion.site/image/https%3A%2F%2Fcdn-img.panewslab.com%2Fpanews%2F2022%2F06%2F09%2Fimages%2FBq83qjv8NI.jpg?table=block&id=c086e402-9c85-457e-bfe5-5655ac84ac3c&spaceId=15e1b553-cd90-4911-afdb-43e2b044cf64&width=2000&userId=&cache=v2]

## Solana 出块流程简述

1. 用户发起交易后，会被客户端直接转发给 Leader 节点，或者先被普通节点接收，再立刻转发给 Leader
2. 出块者 Leader 接收网络内全部的待处理交易，一边执行，一边给交易指令排序，制成交易序列（类似区块）。每隔一段时间，Leader 会把排好的交易序列发送给 Validator 验证节点；（POH）
   !()[https://syshems.notion.site/image/https%3A%2F%2Fcdn-img.panewslab.com%2Fpanews%2F2022%2F06%2F09%2Fimages%2F6iOX2k40Ee.jpg?table=block&id=83bf4c3d-3546-449e-babe-2ba575c4df88&spaceId=15e1b553-cd90-4911-afdb-43e2b044cf64&width=1820&userId=&cache=v2]
3. Validator 按照交易序列（区块）给定的顺序执行交易，产生相应的状态信息 State（执行交易会改变节点的状态，比如改变某些账户的余额）；
4. 每发送 N 个交易序列，Leader 会定期公开本地的状态 State ，Validator 会将其与自己的 State 作对比，给出 肯定/否定 的投票。这一步就类似于以太坊 2.0 或其他 POS 公链里的“检查点”
   !()[https://syshems.notion.site/image/https%3A%2F%2Fcdn-img.panewslab.com%2Fpanews%2F2022%2F06%2F09%2Fimages%2FBq83qjv8NI.jpg?table=block&id=c086e402-9c85-457e-bfe5-5655ac84ac3c&spaceId=15e1b553-cd90-4911-afdb-43e2b044cf64&width=2000&userId=&cache=v2]
   上图中主要会涉及 两类节点：(Leader&Verifier.md)
   1. Leader，POH 生成者
   2. Verifier,复制节点（ROREP）
5. 如果在规定时间内，Leader 收集到占全网 2/3 质押权重 的节点们给出的肯定票，则此前发布的交易序列和状态 State 就被敲定，“检查点”通过，相当于区块完成最终确认 Finality；
6. 一般而言，给出肯定票的 Validator 节点与出块者 Leader 所执行的交易、执行后的状态都是相同的，数据会同步。
7. 每过 4 个 Slot 周期，Leader 会进行一次切换，这意味着 Leader 每次大概有 1.6 秒~3.2 秒时间掌握网络的“最高话语权”。

**在分布式系统中，根据 CAP 理论，一致性和可用性之间，是要有取舍的；Solana 则选择控制分区，提供了一种机制，确保网络的分区的节点数量是在可控范围内的**
