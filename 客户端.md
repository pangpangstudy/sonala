# 客户端

## Json RPC API

RPC
RPC(Remote Procedure Calls )远程过程调用是一种协议，就是从一台机器（客户端）上通过参数传递的方式调用另一台机器（服务器）上的一个函数或方法（可以统称为服务）并得到返回的结果。

RPC 协议通常的实现有 XML-RPC , JSON-RPC ,gRPC 等，它们的通信方式基本相同, 所不同的只是传输数据的格式。

RPC 是分布式架构的核心，按响应方式分如下两种：

1. 同步调用：客户端调用服务方方法，等待直到服务方返回结果或者超时，再继续自己的操作。
2. 异步调用：客户端把消息发送给中间件，不再等待服务端返回，直接继续自己的操作。

一个完整的 RPC 架构里面包含了四个核心的组件，分别是 Client，Client Stub，Server 以及 Server Stub：

1. 客户端(Client)，服务的调用方。
2. 客户端存根(Client Stub)，存放服务端的地址消息，再将客户端的请求参数打包成网络消息，然后通过网络远程发送给服务方。
3. 服务端(Server)，真正的服务提供者。
4. 服务端存根(Server Stub)，接收客户端发送过来的消息，将消息解包，并调用本地的方法。

### RPC 调用流程

该流程中的具体步骤是：

1. 服务调用方（client）(客户端)以本地调用方式调用服务。
2. client stub 接收到调用后负责将方法、参数等组装成能够进行网络传输的消息体；在 Java 里就是序列化的过程。
3. client stub 找到服务地址，并将消息通过网络发送到服务端。
4. server stub 收到消息后进行解码,在 Java 里就是反序列化的过程。
5. server stub 根据解码结果调用本地的服务。
6. 本地服务执行处理逻辑。
7. 本地服务将结果返回给 server stub。
8. server stub 将返回结果打包成消息，主要也是 Java 里的序列化过程。
9. server stub 将打包后的消息通过网络并发送至消费方。
10. client stub 接收到消息，并进行解码, Java 里的反序列化。
11. 服务调用方（client）得到最终结果。
